# [000114] Remove on-chain iteration over the entire collection. Implement a Merkle Drop system where the dividend snapshot is calculated off-chain, and users claim against a Merkle Root.
  
  ### Summary

Unbounded loops in A26ZDividendDistributor.sol will cause a permanent denial of service for the protocol owner as the gas required to distribute dividends will exceed the block gas limit.

### Root Cause

In src/contracts/A26ZDividendDistributor/A26ZDividendDistributor.sol, the functions getTotalUnclaimedAmounts and _setDividends iterate from 0 to nft.getTotalMinted(). This iterates over every NFT ever minted, regardless of whether it is burned or active.


### Internal Pre-conditions

1-The number of minted NFTs must grow large enough to make the loop cost more than 30M gas (approx. 2000-5000 NFTs depending on chain).

### External Pre-conditions

None.

### Attack Path

1-Protocol operates normally, minting TVSs.
2-Owner calls setDividends().
3-The transaction runs out of gas and reverts.
4-Dividend funds are stuck in the contract.

### Impact

The dividend mechanism becomes unusable. The protocol fails to deliver promised rewards to users.


### PoC

```solidity
function test_PoC_4_Dividend_DoS_Loop() public {
    setUpPoC();
    uint256 iterations = 100; 
    
    vm.startPrank(owner); 
    for(uint i=0; i<iterations; i++) {
        nft.mint(makeAddr("randomUser"));
    }
    vm.stopPrank();

    vm.prank(owner);
    // Expect Revert due to gas or broken logic in loop
    vm.expectRevert(); 
    distributor.setDividends();
}
```

### Mitigation

Remove on-chain iteration over the entire collection. Implement a Merkle Drop system where the dividend snapshot is calculated off-chain, and users claim against a Merkle Root.

  