# [000298] Uninitialized memory array
  
  

**Summary:** The function fails to initialize the `newAmounts` memory array before writing to it, causing all transactions to revert.

**Root Cause:** The `newAmount` array is never  initialize in ` calculateFeeAndNewAmountForOneTVS` function which causes un-necessary revert.

**Vulnerability Details:** The `newAmount` array is never allocated hence it always revert. `uint256[] memory newAmounts;` is declared but never allocated to memory then immediately this is written `newAmounts[i] = ...` as this will always revert with a ` “index out of bounds” or “invalid memory access” error.`
```javascript
    //@audit-issue
    function calculateFeeAndNewAmountForOneTVS(uint256 feeRate, uint256[] memory amounts, uint256 length) public pure returns (uint256 feeAmount, uint256[] memory newAmounts) {
        for (uint256 i; i < length;) {
            feeAmount += calculateFeeAmount(feeRate, amounts[i]);
            newAmounts[i] = amounts[i] - feeAmount;
        }
    }
```
**Impact:**
1. All calls to this function will revert, making it completely unusable
2. Any contract relying on this function for fee calculations will fail
3. Breaks batch processing functionality entirely

**Tool Used:**Manual review

**POC:**


Affected Line of code: https://github.com/dualguard/2025-11-alignerz/blob/main/protocol/src/contracts/vesting/feesManager/FeesManager.sol#L169

**Recommended Mitigation:** Inside the `calculateFeeAndNewAmountForOneTVS` function add this, 
```javascript
// Initialize the array with proper length
    newAmounts = new uint256[](length);
```

  