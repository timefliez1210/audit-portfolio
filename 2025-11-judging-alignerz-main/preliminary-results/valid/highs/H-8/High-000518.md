# [000518] Infinite Loop in `getUnclaimedAmounts` Due to Missing Loop Counter Increment on `Continue`
  
  ### Summary

The `getUnclaimedAmounts` function contains a critical bug where the loop counter `i` is not incremented when `continue` statements are hit early in the loop. This causes an infinite loop that exhausts gas and reverts the transaction, making the function completely unusable when certain conditions are met.


### Root Cause

The loop uses manual increment with `unchecked { ++i; }` placed only at the end of the loop body. However, two `continue` statements appear before this increment:

In `A26ZDividendDistributor.sol` in `getUnclaimedAmounts()` function
```solidity
function getUnclaimedAmounts(){
    //...code
for (uint i; i < len;) {
@>  if (claimedFlows[i]) continue;  // ← i NOT incremented
    if (claimedSeconds[i] == 0) {
        amount += amounts[i];
@>      continue;  // ← i NOT incremented
    }
    // ... calculations ...
    unchecked { ++i; }  // ← Only reached if no continue
}
//...code
}
```
When either `continue` is triggered, the loop jumps back to the condition check without incrementing `i`, creating an infinite loop on the same index.

Code Snippet-
https://github.com/dualguard/2025-11-alignerz/blob/f7eeed88d91356484c02af6f38b71f27b790828c/protocol/src/contracts/A26ZDividendDistributor/A26ZDividendDistributor.sol#L140-L161



### Internal Pre-conditions

1. Any NFT allocation where `claimedFlows[i] == true` for any index.
2. Any NFT allocation where `claimedSeconds[i] == 0` for any index.
3. Function is called by owner (directly or indirectly through `setAmounts()` or `setUpTheDividends`).


### External Pre-conditions

N/A

### Attack Path

1. Owner calls `setUpTheDividends()` → calls `_setAmounts()` → calls `getTotalUnclaimedAmounts()`.
2. `getTotalUnclaimedAmounts()` loops through all NFTs and calls `getUnclaimedAmounts(nftId)` for each.
3. For any NFT where first allocation has `claimedFlows[0] == true` OR `claimedSeconds[0] == 0`: (assuming in loop there has a NFT id whose `claimedFlows[0] == true` OR `claimedSeconds[0] == 0`).
   - Loop gets stuck at `i=0`
   - Gas exhaustion → transaction reverts (exceed block gas limit)  
4. Due to this Entire dividend setup process fails.



### Impact

 Cannot calculate or set dividends for TVS holders. Stablecoins sent to contract cannot be distributed properly. Core functionality permanently disabled if even one NFT has the triggering this condition. All dividend related function will broke because of this.


### PoC

N/A

### Mitigation


**Apply Manual increment before each continue**

```solidity
for (uint i; i < len;) {
    if (claimedFlows[i]) {
        unchecked { ++i; }  // ← Add increment
        continue;
    }
    if (claimedSeconds[i] == 0) {
        amount += amounts[i];
        unchecked { ++i; }  // ← Add increment
        continue;
    }
    uint256 claimedAmount = claimedSeconds[i] * amounts[i] / vestingPeriods[i];
    uint256 unclaimedAmount = amounts[i] - claimedAmount;
    amount += unclaimedAmount;
    unchecked { ++i; }
}
```

  