# [000666] Missing `claimedSeconds` reset causes dividend DoS and miscalculation across distribution periods.
  
  ### Summary

Failing to reset `dividendsOf[user].claimedSeconds` to `0` at the start of a new distribution period causes users who partially claimed in previous periods to either be unable to claim (DoS) or receive incorrect dividend amounts. This happens because outdated `dividendsOf[user].claimedSeconds` values are compared against the new period’s timeline, leading to invalid `claimableSeconds` calculations.

### Root Cause

https://github.com/dualguard/2025-11-alignerz/blob/main/protocol/src/contracts/A26ZDividendDistributor/A26ZDividendDistributor.sol#L187
In `claimDividends()`, the variable `dividendsOf[user].claimedSeconds` is used to track how many seconds of dividends a user has already claimed within the current distribution period.
When the user claims after the vesting period is fully completed, the function correctly resets both `dividendsOf[user].amount` and `dividendsOf[user].claimedSeconds` to `0`.

However, when the user claims before the end of the vesting period (the else branch), `dividendsOf[user].claimedSeconds` is updated but never reset.
If the protocol later starts a new distribution period (with `startTime` updated), `dividendsOf[user].claimedSeconds` is unchanged.

This leads to a temporal mismatch:
`dividendsOf[user].claimedSeconds` from the previous period is compared against `secondsPassed` computed from the new `startTime`.
```solidity
    uint256 claimedSeconds = dividendsOf[user].claimedSeconds;
    ...
    secondsPassed = block.timestamp - startTime;
    ...
    uint256 claimableSeconds = secondsPassed - claimedSeconds;
```
 `claimableSeconds` can underflow or be smaller than supposed to. It causes incorrect payouts or making dividend claims impossible.


### Internal Pre-conditions

_No response_

### External Pre-conditions

_No response_

### Attack Path

1. user1 calls `claimDividends()` after 29 days.
   -> He receives the dividends corresponding to the elapsed 29 days and `dividendsOf[user].claimedSeconds = 29 days`
2. A new distribution period begins : the protocol calls:
    - `setStartTime()`
    - `setUpTheDividends()`
      - `dividendsOf[user1].claimedSeconds` is not reset to `0`, causing a mismatch with the new period.
3. user1 calls `claimDividends()` during the new period:
    * Scenario A: after 10 days:
      - `claimedSeconds = 29 days`
      - `secondsPassed = block.timestamp - startTime = 10 days`
      - `claimableSeconds = secondsPassed - claimedSeconds = -19 days` → function reverts.

    * Scenario B: after 40 days:
      - `claimedSeconds = 29 days`
      - `secondsPassed = 40 days`
      - `claimableSeconds = 11 days` → user1 receives less than he should, since the previous period's `dividendsOf[user].claimedSeconds` incorrectly reduces the claimable amount.

### Impact

- Users lose a part of their dividends.
- Users can't claim their dividends.

### PoC

_No response_

### Mitigation

Reset `dividendsOf[].claimedSeconds` to `0` for every user when you start a new period distribution.
  