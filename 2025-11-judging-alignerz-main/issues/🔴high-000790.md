# [000790] Autogenerated Getter for Dynamic Allocation Struct Reverts
  
  ### Summary

Using Solidity’s autogenerated getter for a struct containing dynamic arrays will cause a permanent denial of access to vesting data, resulting in all distributed tokens being stuck indefinitely for users and the protocol, as the DividendDistributor contract attempts to read dynamic fields through `allocationOf`, which always reverts.


### Root Cause

In case it’s a mistake in the code:  
- In A26ZDividendDistributor.sol the call to `vesting.allocationOf(nftId)` relies on Solidity’s autogenerated getter, but the underlying `Allocation` struct contains dynamic arrays, which autogenerated getters cannot return, causing the EVM to revert on every call.  
- In AlignerzVesting.sol the design choice of exposing `allocationOf` as a public mapping with dynamic arrays leads to an unusable getter, as Solidity silently drops dynamic fields from autogenerated getters, making the struct **inaccessible at runtime**.

Reference: Solidity documentation on getter functions  
(https://docs.soliditylang.org/en/latest/contracts.html#getter-functions)

[Allocation struct](https://github.com/dualguard/2025-11-alignerz/blob/main/protocol/src/contracts/vesting/AlignerzVesting.sol#L71-L80)
[allocationOf mapping](https://github.com/dualguard/2025-11-alignerz/blob/main/protocol/src/contracts/vesting/AlignerzVesting.sol#L114)

[fetching dynamic data that aren't actually returned](https://github.com/dualguard/2025-11-alignerz/blob/main/protocol/src/contracts/A26ZDividendDistributor/A26ZDividendDistributor.sol#L141-L146)


### Internal Pre-conditions

_No response_

### External Pre-conditions

_No response_

### Attack Path

1. A user deposits tokens intended for distribution into `DividendDistributor`.
2. The protocol (or users) later attempts to call `getUnclaimedAmounts(nftId)` to compute pending vesting amounts.
3. This function internally calls `vesting.allocationOf(nftId)` multiple times.
4. Because the autogenerated getter cannot return dynamic array fields, each call reverts, preventing calculation of unclaimed amounts.
5. As a result, the distribution process cannot proceed, and tokens inside the contract become permanently inaccessible.


### Impact

The users suffer an inability to claim tokens.  
No PoC is required, as the failure is a guaranteed runtime revert due to Solidity’s getter generation rules.


### PoC

_No response_

### Mitigation

Implement a custom getter function inside `AlignerzVesting` that manually returns the full `Allocation` struct, including all dynamic arrays.  
Then update `DividendDistributor` to use this new getter instead of relying on the autogenerated `allocationOf` mapping accessor.
  