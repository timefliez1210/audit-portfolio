# [000794] Incorrect Hardcoded `poolId` Prevents Refunds for Non-Zero Pools
  
  ### Summary

The hardcoded `poolId = 0` in the `claimRefund` Merkle leaf construction will cause an inability to process valid refunds for users in non-zero pools as the protocol will always verify against the wrong leaf and fail Merkle validation.

### Root Cause

In `AlignerzVesting.sol:claimRefund` the Merkle leaf is always computed using `poolId = 0`, ignoring the actual `poolId` that should be part of the refund tree.  
This prevents users belonging to other pools from generating a matching Merkle proof.

[poolId always 0](https://github.com/dualguard/2025-11-alignerz/blob/main/protocol/src/contracts/vesting/AlignerzVesting.sol#L842)

### Internal Pre-conditions

_No response_

### External Pre-conditions

_No response_

### Attack Path

This is not an attack, it's informational.
1. A user who belongs to a pool with `poolId != 0` calls `claimRefund(projectId, amount, merkleProof)`.
2. The function constructs the leaf as `keccak256(abi.encodePacked(msg.sender, amount, projectId, 0))`.
3. The Merkle proof the user provides (constructed with the correct poolId) does not match the hardcoded leaf.
4. The `MerkleProof.verify` call fails, causing the refund claim to revert.


### Impact

Users assigned to any pool other than `poolId = 0` cannot claim refunds, as their valid Merkle proofs will never match the protocol-side leaf.  
No direct financial loss occurs, but refunds for these users become impossible.


### PoC

_No response_

### Mitigation

Replace the hardcoded `poolId = 0` with the correct pool identifier associated with the userâ€™s bid or project configuration.  
Ensure the poolId used in the Merkle tree generation matches the one used when verifying claims on-chain.

  