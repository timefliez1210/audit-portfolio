# [000885] Missing Loop Increment in calculateFeeAndNewAmountForOneTVS
  
  ### Summary

The function calculateFeeAndNewAmountForOneTVS is intended to compute cumulative fees and corresponding post-fee amounts for an array of input values. However, the for loop inside the function fails to increment the loop counter i. As a result, the loop becomes infinite, causing the function to never terminate and always revert due to out-of-gas conditions.

### Root Cause

https://github.com/dualguard/2025-11-alignerz/blob/main/protocol/src/contracts/vesting/feesManager/FeesManager.sol#L169

```sol
function calculateFeeAndNewAmountForOneTVS(
    uint256 feeRate, 
    uint256[] memory amounts, 
    uint256 length
) 
    public 
    pure 
    returns (uint256 feeAmount, uint256[] memory newAmounts) 
{
    for (uint256 i; i < length;) {
        feeAmount += calculateFeeAmount(feeRate, amounts[i]);
        newAmounts[i] = amounts[i] - feeAmount;
    }
}
```

The for loop is defined as:

```sol
for (uint256 i; i < length;) {
```

However, the loop body does not increment i, meaning,

i remains 0 forever.

i < length always evaluates to true unless length is 0.

The loop continues without progress.

The EVM repeatedly executes the same statements until all gas is consumed.

This results in an infinite loop, making the function unusable, because the loop never advances, newAmounts is never allocated,  amounts[i] repeatedly accesses index 0, but this is never reached due to OOG revert.

Any caller calling this function will always fail, halting higher-level logic.


### Internal Pre-conditions

None

### External Pre-conditions

None

### Attack Path

None

### Impact

Function is completely non-functional.

Every call results in out-of-gas termination.

Any part of the system depending on this function will fail

Denial of Service on contract workflows using this function.

### PoC

None

### Mitigation

Include i++ in the loop so iteration progresses correctly
  