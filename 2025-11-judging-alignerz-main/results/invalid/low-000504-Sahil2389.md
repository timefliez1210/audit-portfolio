# [000504] Off-By-One Timestamp Error Prevents Claims at Exact Deadline Block - Users Lose One Block of Claim Window
  
  ### Summary

The claim functions use `block.timestamp < claimDeadline` while distribution functions use `block.timestamp > claimDeadline`, creating a one-block gap where neither KOLs can claim nor owner can distribute. Users who attempt to claim at exactly `block.timestamp == claimDeadline` are incorrectly rejected, losing their rightful claim window.


### Root Cause


In `AlignerzVesting.sol` contract have Inconsistent Boundary Condition Logic:

```solidity
// User claim functions - STRICT inequality
function claimRewardTVS(uint256 rewardProjectId) external {
@>  require(block.timestamp < rewardProject.claimDeadline, Deadline_Has_Passed());
    // Can claim ONLY if: block.timestamp < deadline
    // CANNOT claim if: block.timestamp == deadline 
}

function claimStablecoinAllocation(uint256 rewardProjectId) external {
@>  require(block.timestamp < rewardProject.claimDeadline, Deadline_Has_Passed());
    // Same issue 
}

// Owner distribution functions - STRICT inequality
function distributeRemainingRewardTVS(uint256 rewardProjectId) external onlyOwner {
@>  require(block.timestamp > rewardProject.claimDeadline, Deadline_Has_Not_Passed());
    // Can distribute ONLY if: block.timestamp > deadline
    // CANNOT distribute if: block.timestamp == deadline 
}
```

The Gap->  If `block.timestamp == claimDeadline`:
  - Users CANNOT claim (requires `<`)
  - Owner CANNOT distribute (requires `>`)
  - One block is lost to neither party

Code snippet-
https://github.com/dualguard/2025-11-alignerz/blob/f7eeed88d91356484c02af6f38b71f27b790828c/protocol/src/contracts/vesting/AlignerzVesting.sol#L506-L535


### Internal Pre-conditions

1. `claimDeadline` is set during project launch: `startTime + claimWindow`.
2. User attempts claim at exact deadline block.


### External Pre-conditions

1. User transaction is mined at exactly `block.timestamp == claimDeadline`.

### Attack Path


Scenario: User Claims at Exact Deadline

1. Project Setup:
   - `startTime = 1000000`
   - `claimWindow = 86400` (1 day)
   - `claimDeadline = 1086400`

2. User Attempts Claim at Deadline:
```solidity
// block.timestamp = 1086400 (exactly at deadline)
claimRewardTVS(projectId);
//  REVERTS: "Deadline_Has_Passed()"
// Expected: Should succeed since deadline hasn't "passed"
```

3. Owner Attempts Distribution at Deadline:
```solidity
// Same block: block.timestamp = 1086400
distributeRemainingRewardTVS(projectId);
//  REVERTS: "Deadline_Has_Not_Passed()"
// Expected: Should succeed since deadline has "passed"
```

4. Neither Can Act:
   - User loses rightful claim opportunity at deadline
   - Owner must wait for next block to distribute
   - Funds locked for one additional block unnecessarily

### Impact

Users lose valid claim opportunity at exact deadline timestamp. Block time ~12 seconds (Ethereum) means 12-second window where no one can act.  Contradicts standard deadline semantics (deadlines are typically inclusive).


### PoC

N/A

### Mitigation

N/A
  